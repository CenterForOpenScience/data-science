---
title: "Untitled"
output: 
  flexdashboard::flex_dashboard:
    orientation: column
    theme: bootstrap
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(gt)
library(here)
library(highcharter)

user_generation_data <- read_csv(here::here('Quarterly_Reports/data_for_mockup.csv'))
```

Column
-----------------------------------------------------------------------

### Last Month's Numbers Table {data-height=500}

```{r}
user_generation_data %>%
  group_by(product, user_type) %>%
  slice(1L) %>%
  ungroup() %>%
  select(-date) %>%
  pivot_wider(names_from = product, values_from = new_n) %>%
  gt() %>%
  cols_label(
    user_type = 'Type of User',
    osf = 'OSF',
    osf4m = 'OSFMeetings',
    preprints = 'Preprints',
    registries = 'Registries'
  )
  
  
```


### New users generated by product {data-height=500}

```{r}
user_generation_data %>%
  filter(user_type == 'new_active') %>%
  hchart(., type = 'line',
         hcaes(x = date,
               y = new_n,
               group = product)) %>%
  hc_tooltip(table = TRUE, sort = TRUE) %>%
  hc_plotOptions(series = list(marker = list(enabled = FALSE))) %>%
  hc_xAxis(title = list(text = ""), tickInterval = 86400000 * 30) %>% #tick interval for date in milliseconds
  hc_yAxis(title = list(text = "Newly Registered Users")) %>%
  hc_exporting(
    enabled = TRUE, filename="newuser_generation", 
              formAttributes=list(target="_blank"),
               buttons=list(contextButton=list(
               text="Export", theme=list(fill="transparent"))))
```


Column
-----------------------------------------------------------------------

### Unregistered contributors added by products {data-height=500}

```{r}
user_generation_data %>%
  filter(user_type == 'nonreg_added') %>%
  hchart(., type = 'line',
         hcaes(x = date,
               y = new_n,
               group = product)) %>%
  hc_tooltip(table = TRUE, sort = TRUE) %>%
  hc_plotOptions(series = list(marker = list(enabled = FALSE))) %>%
  hc_xAxis(title = list(text = ""), tickInterval = 86400000 * 30) %>% #tick interval for date in milliseconds
  hc_yAxis(title = list(text = "Newly Registered Users")) %>%
  hc_exporting(
    enabled = TRUE, filename="newuser_generation", 
              formAttributes=list(target="_blank"),
               buttons=list(contextButton=list(
               text="Export", theme=list(fill="transparent"))))
```

### Unregistered contributors claiming accounts by product {data-height=500}

```{r}
user_generation_data %>%
  filter(user_type == 'nonreg_claimed') %>%
  hchart(., type = 'line',
         hcaes(x = date,
               y = new_n,
               group = product)) %>%
  hc_tooltip(table = TRUE, sort = TRUE) %>%
  hc_plotOptions(series = list(marker = list(enabled = FALSE))) %>%
  hc_xAxis(title = list(text = ""), tickInterval = 86400000 * 30) %>% #tick interval for date in milliseconds
  hc_yAxis(title = list(text = "Newly Registered Users")) %>%
  hc_exporting(
    enabled = TRUE, filename="newuser_generation", 
              formAttributes=list(target="_blank"),
               buttons=list(contextButton=list(
               text="Export", theme=list(fill="transparent"))))
```






